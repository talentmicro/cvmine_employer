<p-toast />
<div class="container-fluid py-4">
    <div class="row g-4">
        <!-- Main Content -->
        <div class="col-12 col-lg-8">
            <div class="applicant-details-container">
                <!-- Header Section -->
                <div class="header-section mb-4">
                    <div class="d-flex align-items-center justify-content-between gap-2">
                        <button class="btn btn-outline-primary d-flex align-items-center gap-2" routerLink="/job-applicants">
                            <i class="pi pi-arrow-left"></i>
                            <span class="d-none d-sm-inline">Back to Applicants</span>
                        </button>
                        <div class="job-title-badge">
                            <span class="badge bg-primary fs-6 px-3 py-2">{{ applicantDetails?.position }}</span>
                        </div>
                    </div>
                </div>

                <!-- Applicant Profile Card -->
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-white border-bottom d-flex justify-content-between align-items-center py-3">
                        <h4 class="mb-0 text-dark fw-semibold">Applicant Profile</h4>
                        <p-tag [value]="applicantDetails?.status"
                            [severity]="getSeverity(applicantDetails?.status)"
                            class="status-badge">
                        </p-tag>
                    </div>

                    <div class="card-body p-4">
                        <!-- Profile Section -->
                        <div class="row g-4 mb-4">
                            <!-- Avatar & Name -->
                            <div class="col-12 col-md-4 text-center text-md-start">
                                <div class="profile-avatar-section">
                                    <p-avatar [label]="applicantDetails?.nameInitials"
                                        size="xlarge"
                                        shape="circle"
                                        styleClass="profile-avatar">
                                    </p-avatar>
                                    <h3 class="applicant-name mt-3 mb-2">{{ applicantDetails?.fullName }}</h3>
                                    <p class="text-muted mb-0">Applicant</p>
                                </div>
                            </div>

                            <!-- Contact Details -->
                            <div class="col-12 col-md-8">
                                <div class="contact-details">
                                    <h5 class="section-title mb-3">Contact Information</h5>
                                    <div class="row g-3">
                                        <div class="col-12 col-sm-6">
                                            <div class="contact-item">
                                                <div class="contact-icon">
                                                    <i class="pi pi-envelope"></i>
                                                </div>
                                                <div class="contact-info">
                                                    <label class="contact-label">Email</label>
                                                    <div class="d-flex align-items-center gap-2">
                                                        <span class="contact-value">{{ applicantDetails?.emailId }}</span>
                                                        <button class="btn btn-sm btn-outline-secondary copy-btn"
                                                            (click)="copyToClipboard(applicantDetails?.resumeDetails?.emailId)"
                                                            title="Copy Email">
                                                            <i class="pi pi-copy"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-12 col-sm-6">
                                            <div class="contact-item">
                                                <div class="contact-icon">
                                                    <i class="pi pi-phone"></i>
                                                </div>
                                                <div class="contact-info">
                                                    <label class="contact-label">Phone</label>
                                                    <div class="d-flex align-items-center gap-2">
                                                        <span class="contact-value">{{ applicantDetails?.mobile || 'N/A' }}</span>
                                                        <button class="btn btn-sm btn-outline-secondary copy-btn"
                                                            (click)="copyToClipboard(applicantDetails?.mobile)"
                                                            title="Copy Phone"
                                                            *ngIf="applicantDetails?.mobile">
                                                            <i class="pi pi-copy"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-12">
                                            <div class="contact-item">
                                                <div class="contact-icon">
                                                    <i class="pi pi-map-marker"></i>
                                                </div>
                                                <div class="contact-info">
                                                    <label class="contact-label">Location</label>
                                                    <span class="contact-value">{{ applicantDetails?.location || 'N/A' }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Job Details & Skills -->
                        <div class="row g-4">
                            <div class="col-12 col-lg-6">
                                <div class="job-details-section">
                                    <h5 class="section-title mb-3">Job Details</h5>
                                    <div class="job-details-grid">
                                        <div class="detail-item">
                                            <span class="detail-label">Job Type:</span>
                                            <span class="detail-value">{{ applicantDetails?.jobTypes }}</span>
                                        </div>
                                        <div class="detail-item">
                                            <span class="detail-label">Experience:</span>
                                            <span class="detail-value">{{ applicantDetails?.experience }}</span>
                                        </div>
                                        <div class="detail-item">
                                            <span class="detail-label">Notice Period:</span>
                                            <span class="detail-value">{{ applicantDetails?.noticePeriod }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 col-lg-6">
                                <div class="skills-section">
                                    <h5 class="section-title mb-3">Key Skills</h5>
                                    <div class="skills-container">
                                        <span *ngFor="let skill of applicantDetails?.keySkills"
                                            class="skill-tag">
                                            {{ skill }}
                                        </span>
                                        <div *ngIf="!applicantDetails?.keySkills?.length" class="no-skills">
                                            <i class="pi pi-info-circle me-2"></i>
                                            No skills listed
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resume Section -->
                <div class="card shadow-sm border-0">
                    <div class="card-header bg-white border-bottom py-3">
                        <h5 class="mb-0 text-dark fw-semibold">
                            <i class="pi pi-file me-2"></i>
                            Resume
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        <div *ngIf="applicantDetails.originalCVPath === ''" class="no-resume-message">
                            <div class="text-center py-5">
                                <i class="pi pi-file-excel text-muted" style="font-size: 3rem;"></i>
                                <p class="text-muted mt-3 mb-0">Resume not available</p>
                            </div>
                        </div>
                        <ng-container *ngIf="applicantDetails.originalCVPath != ''">
                            <ngx-doc-viewer [url]="fileUrl"
                                [viewer]="getViewerType(fileUrl)"
                                style="width: 100%; height: 600px;">
                            </ngx-doc-viewer>
                        </ng-container>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-12 col-lg-4">
            <div class="sidebar-container">
                <!-- Status Management -->
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-white border-bottom py-3">
                        <h5 class="mb-0 text-dark fw-semibold">
                            <i class="pi pi-cog me-2"></i>
                            Application Status
                        </h5>
                    </div>
                    <div class="card-body">
                        <p-dropdown [options]="applicationStatuses"
                            [(ngModel)]="applicantDetails.statusCode"
                            optionLabel="status"
                            optionValue="statusCode"
                            placeholder="Select Status"
                            (onChange)="onStatusChange($event)"
                            styleClass="w-100">
                        </p-dropdown>
                    </div>
                </div>

                <!-- Add Note -->
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-white border-bottom py-3">
                        <h5 class="mb-0 text-dark fw-semibold">
                            <i class="pi pi-plus me-2"></i>
                            Add Note
                        </h5>
                    </div>
                    <div class="card-body">
                        <textarea
                            rows="4"
                            class="form-control mb-3"
                            [(ngModel)]="note"
                            placeholder="Enter your note here..."
                            style="resize: none;">
                        </textarea>
                        <button class="btn btn-primary w-100"
                            [disabled]="isSubmitDisabled()"
                            (click)="submitNote()">
                            <i class="pi pi-send me-2"></i>
                            Submit Note
                        </button>
                    </div>
                </div>

                <!-- Notes History -->
                <div class="card shadow-sm border-0">
                    <div class="card-header bg-white border-bottom py-3">
                        <h5 class="mb-0 text-dark fw-semibold">
                            <i class="pi pi-comments me-2"></i>
                            Notes History
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="notes-container">
                            <div *ngIf="notes.length === 0" class="no-notes-message">
                                <div class="text-center py-4">
                                    <i class="pi pi-inbox text-muted" style="font-size: 2rem;"></i>
                                    <p class="text-muted mt-2 mb-0">No notes available</p>
                                </div>
                            </div>
                            <div *ngFor="let note of notes" class="note-item">
                                <div class="note-content">
                                    <p class="note-text mb-2">{{ note.notes }}</p>
                                    <div class="note-meta">
                                        <small class="text-muted">
                                            <i class="pi pi-calendar me-1"></i>
                                            {{ note.crDate |LocalDateTimePipe }}
                                        </small>
                                        <small class="text-muted ms-3">
                                            <i class="pi pi-user me-1"></i>
                                            {{ note.createdBy }}
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Status Change Confirmation Dialog -->
<p-dialog header="Change Applicant Status"
    [(visible)]="showConfirmation"
    [closable]="false"
    [modal]="true"
    [style]="{width: '400px'}"
    styleClass="status-dialog">
    <div class="mb-3">
        <label for="note" class="form-label fw-semibold">Add Note</label>
        <textarea
            id="note"
            rows="3"
            class="form-control"
            [(ngModel)]="note"
            placeholder="Enter a note for this change...">
        </textarea>
    </div>
    <div class="d-flex justify-content-end gap-2">
        <button class="btn btn-outline-secondary" (click)="cancelStatusChange()">
            Cancel
        </button>
        <button class="btn btn-success" (click)="confirmStatusChange()">
            Confirm
        </button>
    </div>
</p-dialog>
